(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{469:function(e,t,r){var n=r(18);e.exports=function(e){return n(Set.prototype.values,e)}},506:function(e,t,r){var content=r(578);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(26).default)("32dd7785",content,!0,{sourceMap:!1})},510:function(e,t,r){"use strict";r.r(t);var n=r(30),o=(r(108),r(85),r(59),r(66),r(36),r(67),r(10),r(19),r(11),r(20),r(50),r(34),r(69),r(74),r(16)),c=r(264);function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function d(e,t,r){return d=l()?Reflect.construct:function(e,t,r){var a=[null];a.push.apply(a,t);var n=new(Function.bind.apply(e,a));return r&&Object(c.a)(n,r.prototype),n},d.apply(null,arguments)}var h=r(465),f=r(1),m=r(28),E=r(29);r(6),r(22),r(70),r(93),r(65),r(17),r(91),r(12),r(206),r(51),r(207),r(208),r(209),r(210),r(211),r(212),r(213),r(214),r(215),r(216),r(217),r(218),r(219),r(52),r(559),r(560),r(562),r(563),r(564),r(565),r(566),r(567),r(568),r(569),r(570),r(571),r(572),r(573),r(574),r(575),r(576),r(68);function T(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function R(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){Object(f.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var A={DEFAULT_POSITION:[115,80,115],DEFAULT_TARGET:[0,0,0],DEFAULT_UP:[0,1,0],SAFE_FALLBACK_POSITION:[60,40,60],SAFE_FALLBACK_TARGET:[0,0,0],SAFE_FALLBACK_UP:[0,1,0],MIN_CAMERA_DISTANCE:.1,CAMERA_DISTANCE_SCALE:.9,PREDEFINED_VIEWS:{front:{position:[0,0,180],target:[0,0,0],up:[0,1,0]},top:{position:[0,180,0],target:[0,0,0],up:[0,0,-1]},side:{position:[180,0,0],target:[0,0,0],up:[0,1,0]},isometric:{position:[140,105,140],target:[0,0,0],up:[0,1,0]},closeup:{position:[80,60,80],target:[0,0,0],up:[0,1,0]},wide:{position:[250,180,250],target:[0,0,0],up:[0,1,0]}},OPTIMAL_VIEW_FACTORS:{X_FACTOR:.7,Y_FACTOR:.5,Z_FACTOR:.7}},_=16720418,I=.9,w=.1,S={NONLINEAR_EXPONENT:.4,NEUTRAL_VALUE:.5,LOW_TO_MID:{RED_START:.23,RED_RANGE:.75,GREEN_START:.7,GREEN_RANGE:.23,BLUE_START:.27,BLUE_RANGE:-.27},MID_TO_HIGH:{RED_START:.98,RED_RANGE:-.42,GREEN_START:.93,GREEN_RANGE:-.81,BLUE_START:0}},L={AMBIENT_COLOR:6702148,AMBIENT_INTENSITY:.6,MAIN_LIGHT_COLOR:16777215,MAIN_LIGHT_INTENSITY:.8,FILL_LIGHT_COLOR:16772829,FILL_LIGHT_INTENSITY:.4,RIM_LIGHT_COLOR:11206655,RIM_LIGHT_INTENSITY:.3,INTERNAL_LIGHT1_COLOR:16737894,INTERNAL_LIGHT1_INTENSITY:.5,INTERNAL_LIGHT1_DISTANCE:100,INTERNAL_LIGHT2_COLOR:6711039,INTERNAL_LIGHT2_INTENSITY:.3,INTERNAL_LIGHT2_DISTANCE:80},N=function(){function e(t,r){Object(m.a)(this,e),this.THREE=t,this.scene=r,this.currentVTKMesh=null,this.wireframeMesh=null,this.lightingInitialized=!1,this.performanceMode="high"}var t,r;return Object(E.a)(e,[{key:"loadVTKFile",value:(r=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o,c,l,d,h,f,m,E,T=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=T.length>1&&void 0!==T[1]?T[1]:{},n=r.modelSize||420,(o=R({displayName:"placental model",color:_,opacity:I,modelSize:n,lineWidth:r.lineWidth||Math.max(2,Math.round(n/70)),pointSize:r.pointSize||Math.max(8,Math.round(n/17)),enableWireframe:!0,useCylinderGeometry:!0,cylinderSegments:8,onProgress:null,onComplete:null},r)).onProgress&&o.onProgress("Loading ".concat(o.displayName,"..."),0),e.prev=4,e.next=7,this.fetchVTKFile(t,o.onProgress);case 7:return c=e.sent,l=this.parseVTKData(c,o.onProgress,o.modelSize,o.useCylinderGeometry),d=l.geometry,h=l.isPointCloud,f=l.radiusData,m=l.pressureData,E=this.createVTKMesh(d,h,o,f,m),this.addToScene(E,o),o.onComplete&&o.onComplete(E,h,f,m),e.abrupt("return",{success:!0,mesh:E,isPointCloud:h,radiusData:f,pressureData:m});case 16:return e.prev=16,e.t0=e.catch(4),console.error("[VTKLoader] Failed to load VTK file ".concat(t,":"),e.t0),e.abrupt("return",{success:!1,error:e.t0});case 20:case"end":return e.stop()}}),e,this,[[4,16]])}))),function(e){return r.apply(this,arguments)})},{key:"fetchVTKFile",value:(t=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=c.length>1&&void 0!==c[1]?c[1]:null)&&r("Downloading file...",10),e.next=4,fetch(t);case 4:if((n=e.sent).ok){e.next=7;break}throw new Error("HTTP ".concat(n.status,": ").concat(n.statusText));case 7:return e.next=9,n.text();case 9:return o=e.sent,r&&r("File downloaded, parsing data...",30),e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"parseVTKData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t&&t("Parsing VTK data structure...",40);for(var o=e.split("\n"),c=[],l=!1,d=!1,f=!1,m=!1,E=[],T=[],v=[],y=0,R=[],i=0;i<o.length;i++){var line=o[i].trim();if(t&&i%1e3==0){var progress=40+i/o.length*30;t("Parsing VTK data...",progress)}if(line.startsWith("POINTS")){var A=line.split(" ");y=parseInt(A[1]),l=!0,d=!1,f=!1,m=!1}else if(line.startsWith("CELLS")||line.startsWith("POLYGONS")||line.startsWith("LINES"))l=!1,d=!0,f=!1,m=!1;else if(line.startsWith("POINT_DATA"))l=!1,d=!1,f=!1,m=!1;else if(line.startsWith("SCALARS")){var _=line.split(" ");if(_.length>1){var I=_[1].toLowerCase();"radius"===I?(f=!0,m=!1):"pressure"===I?(f=!1,m=!0):(f=!1,m=!1)}l=!1,d=!1}else if(!line.startsWith("LOOKUP_TABLE")){if(l&&E.length<3*y){var w=line.split(" ").filter((function(e){return""!==e})).map(parseFloat);E.push.apply(E,Object(h.a)(w))}if(f&&T.length<y){var S=line.split(" ").filter((function(e){return""!==e})).map(parseFloat);T.push.apply(T,Object(h.a)(S))}if(m&&v.length<y){var L=line.split(" ").filter((function(e){return""!==e})).map(parseFloat);v.push.apply(v,Object(h.a)(L))}if(d&&""!==line.trim()&&!line.startsWith("CELL_TYPES")&&!line.startsWith("POINT_DATA")&&!line.startsWith("SCALARS")&&!line.startsWith("LOOKUP_TABLE")){var N=line.split(" ").filter((function(e){return""!==e})),O=N.map((function(e){return parseInt(e)})).filter((function(e){return!isNaN(e)}));if(O.length>1){var M=O[0];if(O.length===M+1&&(R.push(O),!n))for(var P=1;P<M;P++){var C=O[P],D=O[P+1];void 0===D||isNaN(C)||isNaN(D)||3*C+2<E.length&&3*D+2<E.length&&c.push(E[3*C],E[3*C+1],E[3*C+2],E[3*D],E[3*D+1],E[3*D+2])}}}(line.startsWith("CELL_TYPES")||line.startsWith("POINT_DATA"))&&(d=!1)}}var V=new this.THREE.BufferGeometry;if(n&&T.length>0&&R.length>0){var H=this.createCylinderGeometry(E,T,v,R,r);return{geometry:H,isPointCloud:!1,radiusData:T,pressureData:v}}if(0===c.length&&console.warn("[VTKLoader] No line segments created! Using point cloud fallback."),0===c.length&&E.length>0)return V.setAttribute("position",new this.THREE.Float32BufferAttribute(E,3)),T.length>0&&V.setAttribute("radius",new this.THREE.Float32BufferAttribute(T,1)),v.length>0&&V.setAttribute("pressure",new this.THREE.Float32BufferAttribute(v,1)),{geometry:V,isPointCloud:!0,radiusData:T,pressureData:v};V.setAttribute("position",new this.THREE.Float32BufferAttribute(c,3)),V.computeBoundingBox();var x=V.boundingBox.getCenter(new this.THREE.Vector3),F=V.boundingBox.getSize(new this.THREE.Vector3),j=Math.max(F.x,F.y,F.z),z=r/j;return V.translate(-x.x,-x.y,-x.z),V.scale(z,z,z),{geometry:V,isPointCloud:!1,radiusData:T,pressureData:v}}},{key:"createCylinderGeometry",value:function(e,t,r,n,o){var c=new this.THREE.BufferGeometry,l=[],d=[],f=[],m=[],E=0,v=1/0,y=-1/0;r.length>0&&(v=Math.min.apply(Math,Object(h.a)(r)),y=Math.max.apply(Math,Object(h.a)(r)));var R,A=this.detectBranchingPoints(n,e.length/3),_=T(n);try{for(_.s();!(R=_.n()).done;)for(var I=R.value,S=I[0],i=1;i<S;i++){var L=I[i],N=I[i+1];if(void 0!==N&&L<e.length/3&&N<e.length/3){var O=new this.THREE.Vector3(e[3*L],e[3*L+1],e[3*L+2]),M=new this.THREE.Vector3(e[3*N],e[3*N+1],e[3*N+2]),P=t[L]||w,C=t[N]||w,D=r[L]||0,V=r[N]||0,H=this.pressureToColor(D,v,y),x=this.pressureToColor(V,v,y),F=A.has(L),j=A.has(N),z=this.createTaperedCylinder(O,M,P,C,8,H,x,F,j),G=z.vertices,k=z.normals,B=z.colors,K=z.indices;l.push.apply(l,Object(h.a)(G)),d.push.apply(d,Object(h.a)(k)),f.push.apply(f,Object(h.a)(B));var U,$=T(K);try{for($.s();!(U=$.n()).done;){var W=U.value;m.push(W+E)}}catch(e){$.e(e)}finally{$.f()}E+=G.length/3}}}catch(e){_.e(e)}finally{_.f()}this.createBranchingJunctions(A,e,t,r,v,y,l,d,f,m,E),c.setAttribute("position",new this.THREE.Float32BufferAttribute(l,3)),c.setAttribute("normal",new this.THREE.Float32BufferAttribute(d,3)),c.setAttribute("color",new this.THREE.Float32BufferAttribute(f,3)),c.setIndex(m),c.computeBoundingBox();var Y=c.boundingBox.getCenter(new this.THREE.Vector3),J=c.boundingBox.getSize(new this.THREE.Vector3),X=o/Math.max(J.x,J.y,J.z);return c.translate(-Y.x,-Y.y,-Y.z),c.scale(X,X,X),c}},{key:"pressureToColor",value:function(e,t,r){var n=r>t?(e-t)/(r-t):S.NEUTRAL_VALUE,o=Math.pow(n,S.NONLINEAR_EXPONENT),c=new this.THREE.Color;if(o<S.NEUTRAL_VALUE){var l=2*o,d=S.LOW_TO_MID;c.setRGB(d.RED_START+l*d.RED_RANGE,d.GREEN_START+l*d.GREEN_RANGE,d.BLUE_START+l*d.BLUE_RANGE)}else{var h=2*(o-S.NEUTRAL_VALUE),f=S.MID_TO_HIGH;c.setRGB(f.RED_START+h*f.RED_RANGE,f.GREEN_START+h*f.GREEN_RANGE,f.BLUE_START)}return c}},{key:"createTaperedCylinder",value:function(e,t,r,n,o,c,l){var d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=[],m=[],E=[],T=[],v=(new this.THREE.Vector3).subVectors(t,e).normalize(),y=e.clone(),R=t.clone(),A=r,_=n;if(d){var I=Math.max(.08*r,.005);y.add(v.clone().multiplyScalar(-I)),A=1.02*r}if(h){var w=Math.max(.08*n,.005);R.add(v.clone().multiplyScalar(w)),_=1.02*n}var S=new this.THREE.Vector3(0,1,0),L=(new this.THREE.Vector3).crossVectors(v,S).normalize();L.lengthSq()<.1&&L.crossVectors(v,new this.THREE.Vector3(1,0,0)).normalize();for(var N=(new this.THREE.Vector3).crossVectors(L,v).normalize(),O=0;O<=1;O++)for(var M=O,P=(new this.THREE.Vector3).lerpVectors(y,R,M),C=A+(_-A)*M,D=(new this.THREE.Color).lerpColors(c,l,M),V=0;V<o;V++){var H=V/o*Math.PI*2,x=Math.cos(H)*C,F=Math.sin(H)*C,j=(new this.THREE.Vector3).copy(P).add(L.clone().multiplyScalar(x)).add(N.clone().multiplyScalar(F));f.push(j.x,j.y,j.z);var z=(new this.THREE.Vector3).copy(L.clone().multiplyScalar(x)).add(N.clone().multiplyScalar(F)).normalize();m.push(z.x,z.y,z.z),E.push(D.r,D.g,D.b)}for(var G=0;G<1;G++)for(var k=0;k<o;k++){var B=G*o+k,K=G*o+(k+1)%o,U=(G+1)*o+k,$=(G+1)*o+(k+1)%o;T.push(B,K,U),T.push(U,K,$)}return{vertices:f,normals:m,colors:E,indices:T}}},{key:"createVTKMesh",value:function(e,t,r){var n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(t){var l=new this.THREE.PointsMaterial({color:r.color,size:r.pointSize,transparent:!0,opacity:r.opacity,sizeAttenuation:!0});n=new this.THREE.Points(e,l)}else if(r.useCylinderGeometry&&o&&o.length>0){var d=new this.THREE.MeshMatcapMaterial({color:c&&c.length>0?16777215:r.color,transparent:!0,opacity:r.opacity,vertexColors:c&&c.length>0});n=new this.THREE.Mesh(e,d)}else{var h=new this.THREE.LineBasicMaterial({color:r.color,linewidth:r.lineWidth,transparent:!0,opacity:r.opacity});if(n=new this.THREE.LineSegments(e,h),r.enableWireframe){var f=new this.THREE.LineBasicMaterial({color:16777215&r.color|8947848,linewidth:Math.max(1,r.lineWidth-2),transparent:!0,opacity:.3*r.opacity}),m=new this.THREE.LineSegments(e,f);m.position.copy(n.position),m.scale.copy(n.scale),m.scale.multiplyScalar(1.005),this.wireframeMesh=m}}return n}},{key:"addToScene",value:function(e){this.currentVTKMesh&&this.scene.remove(this.currentVTKMesh),this.wireframeMesh&&this.wireframeMesh!==e&&this.scene.remove(this.wireframeMesh),this.setupSceneLighting(),this.currentVTKMesh=e,this.scene.add(e),this.wireframeMesh&&this.scene.add(this.wireframeMesh)}},{key:"setupSceneLighting",value:function(){if(!this.lightingInitialized){var e=L,t=new this.THREE.AmbientLight(e.AMBIENT_COLOR,e.AMBIENT_INTENSITY);this.scene.add(t);var r=new this.THREE.DirectionalLight(e.MAIN_LIGHT_COLOR,e.MAIN_LIGHT_INTENSITY);r.position.set(10,10,5),r.castShadow=!0,this.scene.add(r);var n=new this.THREE.DirectionalLight(e.FILL_LIGHT_COLOR,e.FILL_LIGHT_INTENSITY);n.position.set(-5,3,-1),this.scene.add(n);var o=new this.THREE.DirectionalLight(e.RIM_LIGHT_COLOR,e.RIM_LIGHT_INTENSITY);o.position.set(0,-5,10),this.scene.add(o);var c=new this.THREE.PointLight(e.INTERNAL_LIGHT1_COLOR,e.INTERNAL_LIGHT1_INTENSITY,e.INTERNAL_LIGHT1_DISTANCE);c.position.set(0,0,0),this.scene.add(c);var l=new this.THREE.PointLight(e.INTERNAL_LIGHT2_COLOR,e.INTERNAL_LIGHT2_INTENSITY,e.INTERNAL_LIGHT2_DISTANCE);l.position.set(20,-10,15),this.scene.add(l),this.lightingInitialized=!0}}},{key:"setCameraPosition",value:function(e){var t=R({position:Object(h.a)(A.DEFAULT_POSITION),target:Object(h.a)(A.DEFAULT_TARGET),up:Object(h.a)(A.DEFAULT_UP)},e),r=d(this.THREE.Vector3,Object(h.a)(t.position)),n=d(this.THREE.Vector3,Object(h.a)(t.target)),o=d(this.THREE.Vector3,Object(h.a)(t.up));if(r.distanceTo(n)<A.MIN_CAMERA_DISTANCE&&(console.warn("[VTKLoader] Camera position too close to target, adjusting..."),t.position=Object(h.a)(A.SAFE_FALLBACK_POSITION),t.target=Object(h.a)(A.SAFE_FALLBACK_TARGET),t.up=Object(h.a)(A.SAFE_FALLBACK_UP)),this.copperScene&&this.copperScene.camera){var c=this.copperScene.camera;try{var l;(l=c.position).set.apply(l,Object(h.a)(t.position)),c.lookAt(d(this.THREE.Vector3,Object(h.a)(t.target))),c.up.copy(o),c.updateProjectionMatrix(),c.updateMatrixWorld()}catch(e){var f,m;console.error("[VTKLoader] Error setting camera position:",e),(f=c.position).set.apply(f,Object(h.a)(A.SAFE_FALLBACK_POSITION)),c.lookAt(d(this.THREE.Vector3,Object(h.a)(A.SAFE_FALLBACK_TARGET))),(m=c.up).set.apply(m,Object(h.a)(A.SAFE_FALLBACK_UP))}}else console.warn("[VTKLoader] Camera not accessible through current scene setup")}},{key:"setPredefinedView",value:function(e){A.PREDEFINED_VIEWS[e]?this.setCameraPosition(A.PREDEFINED_VIEWS[e]):console.warn("[VTKLoader] Unknown view: ".concat(e,". Available views: ").concat(Object.keys(A.PREDEFINED_VIEWS).join(", ")))}},{key:"setCopperScene",value:function(e){this.copperScene=e}},{key:"setPerformanceMode",value:function(e){this.performanceMode=e,console.log("[VTKLoader] Performance mode set to: ".concat(e))}},{key:"getOptimalCameraPosition",value:function(){if(!this.currentVTKMesh||!this.currentVTKMesh.geometry)return{position:Object(h.a)(A.PREDEFINED_VIEWS.isometric.position),target:Object(h.a)(A.PREDEFINED_VIEWS.isometric.target),up:Object(h.a)(A.PREDEFINED_VIEWS.isometric.up)};this.currentVTKMesh.geometry.computeBoundingBox();var e=this.currentVTKMesh.geometry.boundingBox,t=e.getSize(new this.THREE.Vector3),r=e.getCenter(new this.THREE.Vector3),n=Math.max(t.x,t.y,t.z)*A.CAMERA_DISTANCE_SCALE;return{position:[r.x+n*A.OPTIMAL_VIEW_FACTORS.X_FACTOR,r.y+n*A.OPTIMAL_VIEW_FACTORS.Y_FACTOR,r.z+n*A.OPTIMAL_VIEW_FACTORS.Z_FACTOR],target:[r.x,r.y,r.z],up:Object(h.a)(A.DEFAULT_UP)}}},{key:"detectBranchingPoints",value:function(e,t){var r,n=new Map,c=T(e);try{for(c.s();!(r=c.n()).done;)for(var l=r.value,d=l[0],i=1;i<d;i++){var h=l[i],f=l[i+1];void 0!==f&&h<t&&f<t&&(n.has(h)||n.set(h,new Set),n.has(f)||n.set(f,new Set),n.get(h).add(f),n.get(f).add(h))}}catch(e){c.e(e)}finally{c.f()}var m,E=new Map,v=T(n);try{for(v.s();!(m=v.n()).done;){var y=Object(o.a)(m.value,2),R=y[0],A=y[1];A.size>2&&E.set(R,Array.from(A))}}catch(e){v.e(e)}finally{v.f()}return E}},{key:"createBranchingJunctions",value:function(e,t,r,n,c,l,d,f,m,E,v){var y,R=T(e);try{for(R.s();!(y=R.n()).done;){var A=Object(o.a)(y.value,2),_=A[0],I=A[1],S=new this.THREE.Vector3(t[3*_],t[3*_+1],t[3*_+2]),L=r[_]||w,N=n[_]||0,O=this.pressureToColor(N,c,l),M=this.createSeamlessJunction(S,L,O,I,t,r);d.push.apply(d,Object(h.a)(M.vertices)),f.push.apply(f,Object(h.a)(M.normals)),m.push.apply(m,Object(h.a)(M.colors));var P,C=T(M.indices);try{for(C.s();!(P=C.n()).done;){var D=P.value;E.push(D+v)}}catch(e){C.e(e)}finally{C.f()}v+=M.vertices.length/3}}catch(e){R.e(e)}finally{R.f()}}},{key:"createSeamlessJunction",value:function(e,t,r,n,o,c){var l=[],d=[],h=[],f=[],m=[],E=t;if(n&&o&&c){var v,y=T(n);try{for(y.s();!(v=y.n()).done;){var R=v.value;if(3*R+2<o.length){var A=new this.THREE.Vector3(o[3*R],o[3*R+1],o[3*R+2]),_=(new this.THREE.Vector3).subVectors(A,e).normalize(),I=c[R]||t;E=Math.max(E,I),m.push({direction:_,radius:I,distance:e.distanceTo(A)})}}}catch(e){y.e(e)}finally{y.f()}}if(m.length<3)return{vertices:[],normals:[],colors:[],indices:[]};for(var w=.95*E,i=0;i<=6;i++)for(var S=i/6*Math.PI,L=Math.sin(S),N=Math.cos(S),O=0;O<=6;O++){var M,P=O/6*Math.PI*2,C=Math.sin(P),D=Math.cos(P),V=new this.THREE.Vector3(L*D,N,L*C),H=w,x=0,F=w,j=T(m);try{for(j.s();!(M=j.n()).done;){var z=M.value,G=Math.max(0,V.dot(z.direction)),k=Math.pow(G,3);H+=Math.max(w,1.2*z.radius)*k*.3,x+=k,k>.1&&(F=Math.max(F,1.25*z.radius))}}catch(e){j.e(e)}finally{j.f()}var B=1+.2*x;H=Math.max(H*B,F),H=Math.max(H,.9*w);var K=(new this.THREE.Vector3).copy(V).multiplyScalar(H).add(e);l.push(K.x,K.y,K.z);var U=this.calculateSmoothNormal(K,e,m);d.push(U.x,U.y,U.z),h.push(r.r,r.g,r.b)}for(var $=0;$<6;$++)for(var W=0;W<6;W++){var Y=7*$+W,J=Y+6+1;f.push(Y,J,Y+1),f.push(J,J+1,Y+1)}return{vertices:l,normals:d,colors:h,indices:f}}},{key:"calculateSmoothNormal",value:function(e,t,r){var n,o=(new this.THREE.Vector3).subVectors(e,t).normalize(),c=o.clone(),l=0,d=[],h=T(r);try{for(h.s();!(n=h.n()).done;){var f=n.value,m=Math.max(0,o.dot(f.direction)),E=Math.pow(m,2.5)*f.radius;d.push({direction:f.direction,weight:E}),l+=E}}catch(e){h.e(e)}finally{h.f()}if(l>0){var v,y=new this.THREE.Vector3,R=T(d);try{for(R.s();!(v=R.n()).done;){var A=v.value,_=A.weight/l;y.add(A.direction.clone().multiplyScalar(.12*_))}}catch(e){R.e(e)}finally{R.f()}c.add(y)}return c.normalize()}},{key:"dispose",value:function(){this.currentVTKMesh&&(this.scene.remove(this.currentVTKMesh),this.currentVTKMesh=null),this.wireframeMesh&&(this.scene.remove(this.wireframeMesh),this.wireframeMesh=null),this.copperScene=null}}]),e}(),O={props:{useTubeRendering:{type:Boolean,default:!0},currentPerformanceMode:{type:String,default:"high"},modelName:{type:String,default:"Loading..."}},data:function(){return{Copper:null,THREE:null,baseRenderer:null,container:null,vtkLoader:null,_resizeHandler:null,clientMounted:!1}},computed:{mdAndUp:function(){if(!this.clientMounted)return!1;try{return this.$vuetify&&this.$vuetify.breakpoint&&this.$vuetify.breakpoint.mdAndUp}catch(e){return console.warn("[Model] Error accessing vuetify breakpoint:",e),!1}}},mounted:function(){var e=this;this.clientMounted=!0,this.$nextTick((function(){e.waitForPluginsAndInitialize()}))},methods:{getAssetPath:function(e){var t="";t=window.location.pathname.startsWith("/pregnancy-app/")||window.location.hostname.includes("github.io")?"/pregnancy-app":"";var r=e.startsWith("/")?e:"/"+e;return console.log("[Model] Asset path: ".concat(e," -> ").concat(t+r)),t+r},waitForPluginsAndInitialize:function(){var e=arguments,t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=e.length>0&&void 0!==e[0]?e[0]:0,10,200,t.checkPluginsAvailability()?(console.log("[Model] Plugins ready, initializing 3D engine..."),t.initializeCopper3D()):n<10?(console.log("[Model] Plugins not ready, retrying... (".concat(n+1,"/").concat(10,")")),t.$emit("model-state-updated",{modelName:"Loading 3D Engine... (".concat(n+1,"/").concat(10,")")}),setTimeout((function(){t.waitForPluginsAndInitialize(n+1)}),200)):(console.error("[Model] Failed to initialize plugins after maximum retries"),t.$emit("model-state-updated",{modelName:"Error: 3D engine initialization timed out"}));case 4:case"end":return r.stop()}}),r)})))()},checkPluginsAvailability:function(){try{return this.$Copper&&this.$three&&this.$baseRenderer&&this.$baseContainer&&"function"==typeof this.$Copper&&"function"==typeof this.$three&&"function"==typeof this.$baseRenderer&&"function"==typeof this.$baseContainer}catch(e){return!1}},initializeCopper3D:function(){this.waitForDOMAndInitialize()},waitForDOMAndInitialize:function(){var e=arguments,t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=e.length>0&&void 0!==e[0]?e[0]:0,20,100,t.container=t.$refs.baseDomObject,t.container?(console.log("[Model] DOM container found, initializing 3D engine..."),t.initialize3DEngine()):n<20?(console.log("[Model] DOM container not ready, retrying... (".concat(n+1,"/").concat(20,")")),t.$emit("model-state-updated",{modelName:"Preparing 3D Container... (".concat(n+1,"/").concat(20,")")}),setTimeout((function(){t.waitForDOMAndInitialize(n+1)}),100)):(console.error("[Model] Failed to find DOM container after maximum retries"),t.$emit("model-state-updated",{modelName:"Error: DOM container not found"}));case 5:case"end":return r.stop()}}),r)})))()},initialize3DEngine:function(){var e=this;try{this.Copper=this.$Copper(),this.THREE=this.$three(),this.baseRenderer=this.$baseRenderer();var t=this.$baseContainer();if(!this.baseRenderer||!t||!this.container)return console.error("[Model] 3D components not properly initialized"),void this.$emit("model-state-updated",{modelName:"Error: 3D components missing"});setTimeout((function(){t&&e.container&&(e.mdAndUp?t.style.height="100vh":t.style.height="100vw",e.container.appendChild(t)),e.initializeVTKLoader(),e.start()}),100),this.setupResizeListener(t)}catch(e){console.error("[Model] Error initializing 3D components:",e),this.$emit("model-state-updated",{modelName:"Error: Failed to initialize 3D engine"})}},setupResizeListener:function(e){var t=this,r=function(){setTimeout((function(){e&&(t.mdAndUp?e.style.height="100vh":e.style.height="100vw"),t.scene&&t.scene.onWindowResize()}),500)};window.addEventListener("resize",r),this._resizeHandler=r},initializeVTKLoader:function(){try{if(!this.baseRenderer)return void console.error("[Model] Base renderer not available");this.scene=this.baseRenderer.getSceneByName("placental-scene"),void 0===this.scene&&(this.scene=this.baseRenderer.createScene("placental-scene"),this.baseRenderer.setCurrentScene(this.scene)),this.vtkLoader=new N(this.THREE,this.scene.scene),this.vtkLoader.setCopperScene(this.scene),this.vtkLoader.setPerformanceMode(this.currentPerformanceMode),console.log("VTK Loader initialized with camera control and performance mode:",this.currentPerformanceMode)}catch(e){console.error("[Model] Error initializing VTK loader:",e),this.$emit("model-state-updated",{modelName:"Error: VTK loader initialization failed"})}},start:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Loading default placental model..."),r=e.getAssetPath("/model/healthy_gen_np3ns1_flux_250_arterial_tree.vtk"),t.next=4,e.vtkLoader.loadVTKFile(r,{displayName:"Placental Arterial Tree",color:16720418,opacity:1,modelSize:420,useCylinderGeometry:!0,cylinderSegments:10,onProgress:function(t,progress){var r="".concat(t," (").concat(Math.round(progress),"%)");e.$emit("model-state-updated",{modelName:r})},onComplete:function(t,r,n,o){e.$emit("model-state-updated",{modelName:"Placental Arterial Tree"});var c=e.getAssetPath("modelView/noInfarct_view.json");e.scene.loadViewUrl(c),e.scene.onWindowResize()}});case 4:(n=t.sent).success||e.$emit("model-state-updated",{modelName:"Error: ".concat(n.error.message)});case 6:case"end":return t.stop()}}),t)})))()},reloadModel:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("User requested VTK model reload..."),r=e.getAssetPath("/model/healthy_gen_np3ns1_flux_250_arterial_tree.vtk"),t.next=4,e.vtkLoader.loadVTKFile(r,{displayName:"Placental Arterial Tree",color:16724787,opacity:1,modelSize:420,useCylinderGeometry:!0,cylinderSegments:10,onProgress:function(t,progress){var r="".concat(t," (").concat(Math.round(progress),"%)");e.$emit("model-state-updated",{modelName:r})},onComplete:function(t,r){e.$emit("model-state-updated",{modelName:"Placental Arterial Tree"});var n=e.getAssetPath("modelView/noInfarct_view.json");e.scene.loadViewUrl(n)}});case 4:(n=t.sent).success||e.$emit("model-state-updated",{modelName:"Error: ".concat(n.error.message)});case 6:case"end":return t.stop()}}),t)})))()},loadArterialTreeWithCylinders:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Loading arterial tree with cylinder geometry..."),r=e.getAssetPath("/model/healthy_gen_np3ns1_flux_250_arterial_tree.vtk"),t.next=4,e.vtkLoader.loadVTKFile(r,{displayName:"Placental Arterial Tree (Cylinders)",color:16720418,opacity:1,modelSize:420,useCylinderGeometry:!0,cylinderSegments:12,onProgress:function(t,progress){var r="".concat(t," (").concat(Math.round(progress),"%)");e.$emit("model-state-updated",{modelName:r})},onComplete:function(t,r){e.$emit("model-state-updated",{modelName:"Placental Arterial Tree"});var n=e.getAssetPath("modelView/noInfarct_view.json");e.scene.loadViewUrl(n)}});case 4:(n=t.sent).success||e.$emit("model-state-updated",{modelName:"Error: ".concat(n.error.message)});case 6:case"end":return t.stop()}}),t)})))()},loadVenousTree:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.getAssetPath("/model/healthy_gen_np3ns1_flux_250_venous_tree.vtk"),t.next=3,e.vtkLoader.loadVTKFile(r,{displayName:"Placental Venous Tree",color:2237183,opacity:1,modelSize:420,useCylinderGeometry:!0,cylinderSegments:10,onProgress:function(t,progress){var r="".concat(t," (").concat(Math.round(progress),"%)");e.$emit("model-state-updated",{modelName:r})},onComplete:function(t,r){e.$emit("model-state-updated",{modelName:"Placental Venous Tree"});var n=e.getAssetPath("modelView/noInfarct_view.json");e.scene.loadViewUrl(n)}});case 3:(n=t.sent).success||e.$emit("model-state-updated",{modelName:"Error: ".concat(n.error.message)});case 5:case"end":return t.stop()}}),t)})))()},toggleRenderMode:function(){console.log("[Model] Toggle render mode called - reloading model"),this.$emit("model-state-updated",{modelName:"Reloading model..."}),this.start()},cyclePerformanceMode:function(){var e=["high","medium","low","auto"],t=e.indexOf(this.currentPerformanceMode),r=e[(t+1)%e.length];console.log("[Model] Performance mode set to:",r),this.$emit("model-state-updated",{currentPerformanceMode:r})}},beforeDestroy:function(){this.vtkLoader&&(this.vtkLoader.dispose(),this.vtkLoader=null),this._resizeHandler&&(window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null)}},M=O,P=(r(577),r(37)),component=Object(P.a)(M,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"model"},[r("client-only",{scopedSlots:e._u([{key:"fallback",fn:function(){return[r("div",{staticClass:"loading-placeholder"},[r("div",{staticClass:"loading-text"},[e._v("Loading 3D Engine...")])])]},proxy:!0}])},[r("div",{ref:"baseDomObject",class:e.mdAndUp?"baseDom-md":"baseDom-sm",staticStyle:{width:"100%",height:"100%"}})])],1)}),[],!1,null,"48fbd227",null);t.default=component.exports},559:function(e,t,r){"use strict";r(308)("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(309))},560:function(e,t,r){"use strict";r(5)({target:"Set",proto:!0,real:!0,forced:r(21)},{addAll:r(561)})},561:function(e,t,r){"use strict";var n=r(18),o=r(44),c=r(9);e.exports=function(){for(var e=c(this),t=o(e.add),r=0,l=arguments.length;r<l;r++)n(t,e,arguments[r]);return e}},562:function(e,t,r){"use strict";r(5)({target:"Set",proto:!0,real:!0,forced:r(21)},{deleteAll:r(310)})},563:function(e,t,r){"use strict";var n=r(21),o=r(5),c=r(45),l=r(18),d=r(44),h=r(9),f=r(92),m=r(43);o({target:"Set",proto:!0,real:!0,forced:n},{difference:function(e){var t=h(this),r=new(f(t,c("Set")))(t),n=d(r.delete);return m(e,(function(e){l(n,r,e)})),r}})},564:function(e,t,r){"use strict";var n=r(5),o=r(21),c=r(9),l=r(42),d=r(469),h=r(43);n({target:"Set",proto:!0,real:!0,forced:o},{every:function(e){var t=c(this),r=d(t),n=l(e,arguments.length>1?arguments[1]:void 0);return!h(r,(function(e,r){if(!n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},565:function(e,t,r){"use strict";var n=r(21),o=r(5),c=r(45),l=r(18),d=r(44),h=r(9),f=r(42),m=r(92),E=r(469),T=r(43);o({target:"Set",proto:!0,real:!0,forced:n},{filter:function(e){var t=h(this),r=E(t),n=f(e,arguments.length>1?arguments[1]:void 0),o=new(m(t,c("Set"))),v=d(o.add);return T(r,(function(e){n(e,e,t)&&l(v,o,e)}),{IS_ITERATOR:!0}),o}})},566:function(e,t,r){"use strict";var n=r(5),o=r(21),c=r(9),l=r(42),d=r(469),h=r(43);n({target:"Set",proto:!0,real:!0,forced:o},{find:function(e){var t=c(this),r=d(t),n=l(e,arguments.length>1?arguments[1]:void 0);return h(r,(function(e,r){if(n(e,e,t))return r(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},567:function(e,t,r){"use strict";var n=r(21),o=r(5),c=r(45),l=r(18),d=r(44),h=r(9),f=r(92),m=r(43);o({target:"Set",proto:!0,real:!0,forced:n},{intersection:function(e){var t=h(this),r=new(f(t,c("Set"))),n=d(t.has),o=d(r.add);return m(e,(function(e){l(n,t,e)&&l(o,r,e)})),r}})},568:function(e,t,r){"use strict";var n=r(21),o=r(5),c=r(18),l=r(44),d=r(9),h=r(43);o({target:"Set",proto:!0,real:!0,forced:n},{isDisjointFrom:function(e){var t=d(this),r=l(t.has);return!h(e,(function(e,n){if(!0===c(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}})},569:function(e,t,r){"use strict";var n=r(21),o=r(5),c=r(45),l=r(18),d=r(44),h=r(15),f=r(9),m=r(160),E=r(43);o({target:"Set",proto:!0,real:!0,forced:n},{isSubsetOf:function(e){var t=m(this),r=f(e),n=r.has;return h(n)||(r=new(c("Set"))(e),n=d(r.has)),!E(t,(function(e,t){if(!1===l(n,r,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},570:function(e,t,r){"use strict";var n=r(21),o=r(5),c=r(18),l=r(44),d=r(9),h=r(43);o({target:"Set",proto:!0,real:!0,forced:n},{isSupersetOf:function(e){var t=d(this),r=l(t.has);return!h(e,(function(e,n){if(!1===c(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}})},571:function(e,t,r){"use strict";var n=r(21),o=r(5),c=r(7),l=r(9),d=r(32),h=r(469),f=r(43),m=c([].join),E=[].push;o({target:"Set",proto:!0,real:!0,forced:n},{join:function(e){var t=l(this),r=h(t),n=void 0===e?",":d(e),o=[];return f(r,E,{that:o,IS_ITERATOR:!0}),m(o,n)}})},572:function(e,t,r){"use strict";var n=r(21),o=r(5),c=r(45),l=r(42),d=r(18),h=r(44),f=r(9),m=r(92),E=r(469),T=r(43);o({target:"Set",proto:!0,real:!0,forced:n},{map:function(e){var t=f(this),r=E(t),n=l(e,arguments.length>1?arguments[1]:void 0),o=new(m(t,c("Set"))),v=h(o.add);return T(r,(function(e){d(v,o,n(e,e,t))}),{IS_ITERATOR:!0}),o}})},573:function(e,t,r){"use strict";var n=r(5),o=r(2),c=r(21),l=r(44),d=r(9),h=r(469),f=r(43),m=o.TypeError;n({target:"Set",proto:!0,real:!0,forced:c},{reduce:function(e){var t=d(this),r=h(t),n=arguments.length<2,o=n?void 0:arguments[1];if(l(e),f(r,(function(r){n?(n=!1,o=r):o=e(o,r,r,t)}),{IS_ITERATOR:!0}),n)throw m("Reduce of empty set with no initial value");return o}})},574:function(e,t,r){"use strict";var n=r(5),o=r(21),c=r(9),l=r(42),d=r(469),h=r(43);n({target:"Set",proto:!0,real:!0,forced:o},{some:function(e){var t=c(this),r=d(t),n=l(e,arguments.length>1?arguments[1]:void 0);return h(r,(function(e,r){if(n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},575:function(e,t,r){"use strict";var n=r(21),o=r(5),c=r(45),l=r(18),d=r(44),h=r(9),f=r(92),m=r(43);o({target:"Set",proto:!0,real:!0,forced:n},{symmetricDifference:function(e){var t=h(this),r=new(f(t,c("Set")))(t),n=d(r.delete),o=d(r.add);return m(e,(function(e){l(n,r,e)||l(o,r,e)})),r}})},576:function(e,t,r){"use strict";var n=r(5),o=r(21),c=r(45),l=r(44),d=r(9),h=r(92),f=r(43);n({target:"Set",proto:!0,real:!0,forced:o},{union:function(e){var t=d(this),r=new(h(t,c("Set")))(t);return f(e,l(r.add),{that:r}),r}})},577:function(e,t,r){"use strict";r(506)},578:function(e,t,r){var n=r(25)(!1);n.push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Bad+Script&family=Raleway:wght@100;300&display=swap);"]),n.push([e.i,".model[data-v-48fbd227]{position:relative;width:100%;height:100%}.baseDom-md[data-v-48fbd227]{width:100%;height:100vh}.baseDom-sm[data-v-48fbd227]{width:100%;height:100vw}.loading-placeholder[data-v-48fbd227]{display:flex;align-items:center;justify-content:center;width:100%;height:100vh;background:linear-gradient(135deg,#1a1a1a,#2d2d2d)}.loading-placeholder .loading-text[data-v-48fbd227]{color:#fff;font-size:18px;font-weight:300;text-align:center;opacity:.8}@media(max-width:768px){.loading-placeholder[data-v-48fbd227]{height:100vw}}",""]),e.exports=n}}]);